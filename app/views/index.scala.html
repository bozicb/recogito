@(user: models.User)(implicit s: play.api.db.slick.Config.driver.simple.Session)
<html>
  <head>
    <title>RECOGITO</title>
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/index/main.css")" />
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/jquery/jquery-2.0.0.min.js")"></script>
    <script> 
    function toggleDetails(docId) {
      var toggle = $('.toggle-' + docId),
          rows = $('.document-' + docId),
          display = rows.css('display');

      toggle.toggleClass('less');
      if (display == 'none') {
        rows.css('display', 'table-row');
      } else {
        rows.css('display', 'none');
      }
    }
    </script>
  </head>
  
  <body>
    <div id="container">    
      <table>
        <thead>
          <tr>
            <th>Document</th>
            <th colspan="2"># of Parts</th>
            <th>Toponyms</th>
            <th colspan="2">Complete</th>
            <th></th>
          </tr>
        </thead>     
        <tbody>
          @for(doc <- models.GeoDocuments.listAll().sortBy(_.title)) {
          	@defining(user.canEdit(doc.id.get)) { canEdit =>
          	  @if(canEdit) { <tr> } else { <tr class="locked-document"> }
          	    <td> <!-- document title -->
          	      @if(!canEdit) {
          	        <span class="icon locked-document">&#xf023;</span>
          	      }
          	      @doc.title
          	    </td>
          	  
          	    @defining(models.GeoDocumentParts.countForGeoDocument(doc.id.get)) { parts =>
          	  	  <!-- number of parts -->
                  @if(parts == 0) { 
          	        <td colspan="2" class="center">-</td>
          	      } else {
          	        <td class="right">@parts</td><td><a class="icon toggle toggle-@doc.id.get" href="#" onclick="toggleDetails(@doc.id.get); return false;"></a></td>
          	      }         	      
          	    }
          	  
          	    <!-- number of toponyms -->
          	    <td class="center">
          	      @doc.totalToponymCount
          	    </td>
          	  
          	    <td class="stats"> <!-- completion ratio -->
          	      @defining(doc.completionRatio * 100) { completionRatio =>
          	        <div class="meter" title="@{ "%.2f" format (completionRatio) } %">
	                  <span style="width: @completionRatio%"></span>
                    </div>
                  }
          	    </td>
          	    <td class="more-stats"><a href="#" onclick="return false;" class="icon" title="Detailed Stats">&#xf080;</a></td>
          	  
          	    <td class="icons"> <!-- icons: map, public map, text -->
          	      @defining(GeoDocumentTexts.getTextForGeoDocument(doc.id.get)) { text =>
      	            @if(text.isDefined) {
      	              <a class="icon" href="@routes.ApplicationController.showTextAnnotationUI(text.get.id.get)" title="Text Annotation">&#xf0f6;</a>
      	            } else {
      	              <span class="icon"></span>
      	            }
      	          }
          	      <a class="icon" href="@routes.ApplicationController.showGeoResolutionUI(doc.id.get)" title="Geo-Resolution">&#xf0ac;</a>
          	      <a class="icon" href="@routes.DocumentController.get(doc.id.get, Some("csv"))" title="Download CSV">&#xf0ce;</a>
          	      <a class="icon" href="@routes.ApplicationController.showMap(doc.id.get)" title="Public Map">
          	        &#xf0ac;
          	        <span class="icon public">&#xf0c0;</span>
          	      </a>
          	    </td>
          	  </tr>
          	}
          	
          	@for(part <- models.GeoDocumentParts.findByGeoDocument(doc.id.get)) {
              <tr class="document-part document-@doc.id.get">
                <td class="title">@part.title</td>
                
                <td colspan="3"></td>
                
          	    <td> <!-- completion ratio -->
          	      @defining(part.completionRatio * 100) { completionRatio =>
          	        <div class="meter meter-part" title="@{ "%.2f" format (completionRatio) } %">
	                  <span style="width: @completionRatio%"></span>
                    </div>
                  }
          	    </td>
          	    <td></td>
          	    
                <td>
      	          @defining(GeoDocumentTexts.getTextForGeoDocumentPart(part.id.get)) { text =>
      	            @if(text.isDefined) {
      	              <span class="icon"></span>
      	              <span class="icon"></span>
      	              <a class="icon" href="@routes.ApplicationController.showTextAnnotationUI(text.get.id.get)" title="Text">&#xf0f6;</a>
      	            }
      	          }
                </td>
          	  </tr>
            }
          }
          
          @* We need to do some optimization here to avoid redundant DB access! *@
          <tr class="totals">
            @defining(models.GeoDocuments.listAll().map(doc => (doc.totalToponymCount, doc.unverifiedToponymCount))) { totals =>
              @defining(totals.map(_._1).foldLeft(0)(_ + _)) { totalToponyms =>
                <td colspan="3"></td>
                <td class="center">@totalToponyms</td> <!-- Toponyms -->
                <td>
                  @defining(totals.map(_._2).foldLeft(0)(_ + _)) { totalUnverified =>
                    <div class="meter">
                      @defining(100 * (totalToponyms - totalUnverified).toDouble / totalToponyms) { ratio =>
                        <span style="width:@{ratio}%" title="@{"%.2f" format (ratio)} % - @totalUnverified Toponyms to go!"></span>
                      }
                    </div>
                  }
                </td>
                <td></td>
                <td></td>  
              }         
            }
          </tr>
        </tbody> 
      </table>
    
      @*
      <ul>
        @for(document <- models.GeoDocuments.listAll()) {
      	  <li class="geo-document">
      	    @document.title
      	    <a href="@routes.ApplicationController.showMapCorrectionUI(document.id.get)">Map (Gazetteer Correction)</a>
      	    <a href="@routes.ApplicationController.showMap(document.id.get)">Map (Public)</a>
      	    <a href="@routes.DocumentController.get(document.id.get, Some("csv"))">CSV</a>
      	    @defining(GeoDocumentTexts.getTextForGeoDocument(document.id.get)) { text =>
      	      @if(text.isDefined) {
      	        <a href="@routes.ApplicationController.showTextAnnotationUI(text.get.id.get)" target="_blank">Text</a>
      	      }
      	    }
      	    <div class="stats">
      	      @document.totalToponymCount Toponyms Total (not counting ignored and false matches)<br/>
      	      @{document.totalToponymCount - document.unverifiedToponymCount} Toponyms Controlled (Verified + Not identifyable)</br>
      	      @{ "%.2f" format (document.completionRatio * 100) } % Complete</br>
      	      @{ "%.2f" format (document.identificiationRatio * 100) } % Identification rate (Verified vs. Not identifyable)<br/>
      	      NER recall: @{ "%.2f" format (document.nerRecall * 100) } %<br/>
      	      NER precision: @{ "%.2f" format (document.nerPrecision * 100) } %</br> 
      	      Resolution correctness: @{ "%.2f" format (document.resolutionCorrectness * 100) } % 
      	    </div>
      	    <ul>
      	    @for(part <- models.GeoDocumentParts.findByGeoDocument(document.id.get)) {
      	      <li>
      	        @part.title
      	        @defining(GeoDocumentTexts.getTextForGeoDocumentPart(part.id.get).map(_.id).flatten) { textId =>
      	          @if(textId.isDefined) {
      	           <a href="@routes.ApplicationController.showTextAnnotationUI(textId.get)" target="_blank">Text</a>
      	          }
      	        }
      	      </li> 
      	    }
      	    </ul>
      	  </li>      	  
        }
      </ul>
      *@
      
    </div>
    <div id="footer">
      <span id="footer-info"></span>
      <span id="footer-user">You are logged in as: <span class="footer-username">@user.username</span><a href="logout" title="Logout" class="footer-logout">&#xf011;</a></span>
    </div>
  </body>
</html>
